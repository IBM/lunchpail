apiVersion: lunchpail.io/v1alpha1
kind: Application
metadata:
  name: test7h-workdispatcher
spec:
  api: shell
  role: dispatcher
  command: ./src/main.sh
  image: {{ print .Values.global.image.registry "/" .Values.global.image.repo "/jaas-workerpool-worker-alpine-component:" .Chart.AppVersion }}
  env:
    # main.sh from workdispatcher1 uses $taskprefix and $taskprefix2; this overrides an env var from ./workdispatcher-app.yaml
    taskprefix: tasky
    taskprefix2: "3333" # this should pass through, since workdispatcher.yaml does not provide an override

    # not overriding workdispatcher-app; test7c runs main.sh in this mode, so let's replicate that behavior
    METHOD: parametersweep
    SWEEP_MIN: '1'
    SWEEP_MAX: '10'
    SWEEP_STEP: '1'
  code:
    - name: src/main.sh
      source: |
{{ .Files.Get "src/main.sh" | indent 8 }}
