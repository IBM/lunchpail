{{- define "containers/dispatcher" }}
- name: dispatcher
  image: {{ print .Values.global.image.registry "/" .Values.global.image.repo "/jaas-tasksimulator-parquet-component:" .Values.global.image.version }}
  volumeMounts:
    - name: script
      mountPath: "/opt/lunchpail/bin"
  command: ["/opt/lunchpail/bin/simulator.sh"]
  env:
    - name: RUN_NAME
      value: {{ .Values.runName }}
    - name: METHOD
      value: {{ quote .Values.method }}
    - name: TASKS
      value: {{ quote .Values.injectedTasksPerInterval }}
    - name: INTERVAL
      value: {{ quote .Values.intervalSeconds }}
    - name: FORMAT
      value: {{ quote .Values.format }}
    - name: COLUMNS
      value: {{ quote .Values.columns }}
    - name: COLUMN_TYPES
      value: {{ quote .Values.columnTypes }}
    - name: SWEEP_MIN
      value: {{ quote .Values.sweep.min }}
    - name: SWEEP_MAX
      value: {{ quote .Values.sweep.max }}
    - name: SWEEP_STEP
      value: {{ quote .Values.sweep.step }}
    {{- include "queue/env/dataset" . | indent 4 }}

  {{- if .Values.envFroms }}
  envFrom:
  {{ .Values.envFroms | b64dec | fromJsonArray | toYaml | nindent 2 }}
  {{- end }}
    
  {{- if .Values.rbac.runAsRoot }}
  securityContext:
    privileged: true
  {{- end }}
{{- end }}
